# 什麼是 EF 6???

他是一個歷史非常悠久的框架， 2008 年就出來了 ，已經 16 年了
是一個很成熟的一套微軟出的 ORM 框架，這是 .net core 還沒出來時，.net framework 時代就已經存在的 ORM 框架

在那之前有一個  linq to sql ，但 2008 年之後，微軟全面朝 EF 發展

EF  可以支援各種不同的資料庫，包含 no-sql

ORM：Object relational mapping 物件跟關聯之間的對應表

基本上就是在幫我們進行「物件」、「關聯(table)」 之間的轉換
讓我們只需要專心操作物件(寫c#)本身，即可進行資料面的操作

最核心的價值就是這：它讓我們用物件導向的思維，處理資料庫的內容
也就是說，EF 幫我們把我們要操作 DB 的那些所有行為進行抽象化
他把 database 封裝成 物件的樣態，讓我們可以完全不用理解 SQL 語法、不用知道資料庫的存在，純粹靠著 C# 的物件，就能完成資料庫資料的操作

所以當我們都用這個方式操作資料，就會發現會變得非常簡單，直覺，開發速度快 程式程式


# EF 缺點

很難去微調  新增修改刪除的 sql 語法，建議不要調他

效能不好?
保哥表示
他從 2008 年開始，所有專案都是用 EF，包含幾個大型專案，同時上線人數五到十萬人，也從來沒有掛掉過


# EF core

- 2016年，ef6 全部打掉重練
- .net core 出來的新架構
- 據說 .net core 1 的時候， EF core 超級難用
- 一直到現在 .net 8 的時代，已經進步到跟 ef 6 差不多 
- 現在大部分的 ef core 的 api 已經跟舊時代的 ef6 一模一樣!!!
- 支援兩種開發模式，db first 、 code first ，而對於初學者來說，建議使用 db first 

- 搭配 visual studio 的工具  efpower tool，幾乎可以完全不用寫 DBContext 相關的語法 


# 關於 ORM
1. 透過物件導向思維來管理關聯式資料
2. 將結構化的關聯資料對應成物件導向模型
3. 將物件資料對應成關聯資料


# 示範 EF Core
1. 安裝 ef power tool
2. 

# EF

context 要跟多少 table 有關連
屬性名稱代表，要用這個名稱存取 DB
綁定的強行別中，DB 有多少欄位，就代表這個型別會有多少屬性

而屬性名稱該怎麼對應到 DB 的欄位名稱？
全部都會是在 onmodelcreating 的ㄈ法去定義



要在 service 拿 httpcontext 唯一一招

builder.services.addhttpcontextaccessor()
一定要註冊這東西



ef 傳入參數，那個參數不會顯示在 log 中，原因是避免機敏資訊被寫在 log 之中

如果真的需要在 log 顯示的話
必須加上
```c#
options.EnableSensitiveDataLogging();
```


```csharp
d.StartDate.Date == DateTime.Parse("2015-03-21");

//重點是：d.StartDate`.Date`

```

# 用模板新增的 crud

update 的code 寫得很糟

```csharp
[HttpPut("{id}")]
      public async Task<IActionResult> PutCourse(int id, Course course)
      {
          if (id != course.CourseId)
          {
              return BadRequest();
          }
          // 這段意思是
          // 把 course 透過 entry ，attach 到 context ，並且改變狀態變成 modified
          // ef 只要狀態被修改，就會自動把資料產出 update set where 的語法更改狀態
          // 這代表資料表內的每一筆資料、每一筆欄位都會被更新
          _context.Entry(course).State = EntityState.Modified;

          try
          {
              await _context.SaveChangesAsync();
          }
          catch (DbUpdateConcurrencyException)
          {
              if (!CourseExists(id))
              {
                  return NotFound();
              }
              else
              {
                  throw;
              }
          }

          return NoContent();
      }
```